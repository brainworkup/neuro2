% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/DuckDBProcessorR6.R
\docType{class}
\name{DuckDBProcessorR6}
\alias{DuckDBProcessorR6}
\title{DuckDBProcessorR6 Class}
\format{
An R6 class object
}
\description{
An R6 class that provides an efficient data processing pipeline for
neuropsychological data using the DuckDB database engine. It allows for
SQL-based querying and processing of large datasets without loading them
entirely into memory, which is ideal for performance and scalability.
}
\details{
The \code{DuckDBProcessorR6} class handles the connection to a DuckDB database
(either in-memory or file-based), registration of data files (CSV, Parquet,
Arrow/Feather) as virtual tables, and execution of SQL queries. It also
registers and uses the package master lookup (\code{lookup_neuropsych_scales})
to enrich neurocognitive/behavioral data with domain/subdomain/narrow
(and, for neurocog, pass/verbal/timed), and offers summary helpers.

Core features:
\itemize{
\item Connection & extension management
\item Auto-registration of CSVs (and helpers for Parquet/Arrow)
\item Lookup registration into DuckDB (with normalized join_key)
\item \code{domains_ref} materialization from the lookup
\item Enriched views: \code{neurocog_enriched}, \code{neurobehav_enriched}
\item Summaries across domain/subdomain/narrow, with optional stream split
}
}
\section{Methods}{

\describe{
\item{\code{initialize(db_path = ":memory:", data_dir = "data", auto_register = TRUE, setup = TRUE, ...)}}{
Initialize, optionally auto-register data, and bootstrap lookup/domains/views.
}
\item{\code{connect()}}{
Create or reconnect to the DuckDB database.
}
\item{\code{disconnect()}}{
Close the database connection.
}
\item{\code{register_csv(file_path, table_name = NULL, options = NULL)}}{
Register a CSV file as a virtual table.
}
\item{\code{register_parquet(file_path, table_name = NULL)}}{
Register a Parquet file as a virtual table.
}
\item{\code{register_arrow(file_path, table_name = NULL)}}{
Register an Arrow/Feather file as a virtual table.
}
\item{\code{register_all_csvs(data_dir = "data", pattern = "*.csv")}}{
Register all CSV files in a directory.
}
\item{\code{register_all_files(data_dir = "data", formats = c("parquet","arrow","csv"))}}{
Register all supported files in a directory.
}
\item{\code{export_to_parquet(table_name, output_path, compression = "zstd")}}{
Export a registered table to Parquet.
}
\item{\code{query(query, params = NULL)}}{
Execute a SQL query and return results.
}
\item{\code{execute(statement, params = NULL)}}{
Execute a SQL statement that doesn't return results.
}
\item{\code{query_lazy(table_name)}}{
Create a lazy reference to a table for dplyr operations.
}
\item{\code{process_domain(domain, data_type = "neurocog", scales = NULL)}}{
Process a specific domain using SQL.
}
\item{\code{export_to_r6(domain, processor_class = "DomainProcessorR6")}}{
Export processed results to a standard R6 processor.
}
\item{\code{get_domain_summary(include_all = TRUE, by_stream = FALSE)}}{
Get domain-level summary statistics (wrapper over enriched/union).
}
\item{\code{ensure_lookup_registered(force = FALSE)}}{
Public bootstrap: make lookup available in DuckDB with join_key.
}
\item{\code{ensure_domains_ref(force = FALSE)}}{
Public bootstrap: rebuild domains_ref from the lookup.
}
\item{\code{refresh_enriched_views()}}{
Public bootstrap: create enriched views and log unmapped keys.
}
\item{\code{create_indexes()}}{
Create optimized indexes for faster queries.
}
}
}

\section{Public fields}{
\if{html}{\out{<div class="r6-fields">}}
\describe{
\item{\code{con}}{Database connection object}

\item{\code{db_path}}{Database file path}

\item{\code{tables}}{Registered tables}

\item{\code{data_paths}}{Data file paths}

\item{\code{available_extensions}}{Character vector of available DuckDB extensions}
}
\if{html}{\out{</div>}}
}
\section{Methods}{
\subsection{Public methods}{
\itemize{
\item \href{#method-DuckDBProcessorR6-new}{\code{DuckDBProcessorR6$new()}}
\item \href{#method-DuckDBProcessorR6-connect}{\code{DuckDBProcessorR6$connect()}}
\item \href{#method-DuckDBProcessorR6-disconnect}{\code{DuckDBProcessorR6$disconnect()}}
\item \href{#method-DuckDBProcessorR6-register_csv}{\code{DuckDBProcessorR6$register_csv()}}
\item \href{#method-DuckDBProcessorR6-register_parquet}{\code{DuckDBProcessorR6$register_parquet()}}
\item \href{#method-DuckDBProcessorR6-register_arrow}{\code{DuckDBProcessorR6$register_arrow()}}
\item \href{#method-DuckDBProcessorR6-register_all_csvs}{\code{DuckDBProcessorR6$register_all_csvs()}}
\item \href{#method-DuckDBProcessorR6-register_all_files}{\code{DuckDBProcessorR6$register_all_files()}}
\item \href{#method-DuckDBProcessorR6-export_to_parquet}{\code{DuckDBProcessorR6$export_to_parquet()}}
\item \href{#method-DuckDBProcessorR6-query}{\code{DuckDBProcessorR6$query()}}
\item \href{#method-DuckDBProcessorR6-execute}{\code{DuckDBProcessorR6$execute()}}
\item \href{#method-DuckDBProcessorR6-query_lazy}{\code{DuckDBProcessorR6$query_lazy()}}
\item \href{#method-DuckDBProcessorR6-process_domain}{\code{DuckDBProcessorR6$process_domain()}}
\item \href{#method-DuckDBProcessorR6-export_to_r6}{\code{DuckDBProcessorR6$export_to_r6()}}
\item \href{#method-DuckDBProcessorR6-get_domain_summary}{\code{DuckDBProcessorR6$get_domain_summary()}}
\item \href{#method-DuckDBProcessorR6-ensure_lookup_registered}{\code{DuckDBProcessorR6$ensure_lookup_registered()}}
\item \href{#method-DuckDBProcessorR6-ensure_domains_ref}{\code{DuckDBProcessorR6$ensure_domains_ref()}}
\item \href{#method-DuckDBProcessorR6-refresh_enriched_views}{\code{DuckDBProcessorR6$refresh_enriched_views()}}
\item \href{#method-DuckDBProcessorR6-create_indexes}{\code{DuckDBProcessorR6$create_indexes()}}
\item \href{#method-DuckDBProcessorR6-clone}{\code{DuckDBProcessorR6$clone()}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DuckDBProcessorR6-new"></a>}}
\if{latex}{\out{\hypertarget{method-DuckDBProcessorR6-new}{}}}
\subsection{Method \code{new()}}{
Constructor. Create a new DuckDBProcessorR6 instance and
optionally auto-register data files, then bootstrap lookup + domains +
enriched views so summaries/plots are ready to run.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DuckDBProcessorR6$new(
  db_path = ":memory:",
  data_dir = "data",
  auto_register = TRUE,
  setup = TRUE,
  force_lookup = FALSE,
  force_domains_ref = FALSE,
  refresh_views = TRUE,
  verbose = TRUE
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{db_path}}{Path to the DuckDB database file. Use ":memory:" for in-memory DB.}

\item{\code{data_dir}}{Directory containing data files to register.}

\item{\code{auto_register}}{If TRUE, attempt to auto-register supported data files from \code{data_dir}.}

\item{\code{setup}}{If TRUE (default), run bootstrap (register lookup, build domains_ref, refresh views).}

\item{\code{force_lookup}}{If TRUE, re-register the in-memory lookup even if present.}

\item{\code{force_domains_ref}}{If TRUE, rebuild domains_ref even if present.}

\item{\code{refresh_views}}{If TRUE (default), (re)create enriched views after data registration.}

\item{\code{verbose}}{If TRUE (default), print progress messages during bootstrap.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Invisibly returns \code{self}.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DuckDBProcessorR6-connect"></a>}}
\if{latex}{\out{\hypertarget{method-DuckDBProcessorR6-connect}{}}}
\subsection{Method \code{connect()}}{
Open (or re-open) a DuckDB connection based on \code{db_path} and set up extensions.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DuckDBProcessorR6$connect()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
Invisibly returns \code{self} after establishing a connection.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DuckDBProcessorR6-disconnect"></a>}}
\if{latex}{\out{\hypertarget{method-DuckDBProcessorR6-disconnect}{}}}
\subsection{Method \code{disconnect()}}{
Close the open DuckDB connection if present.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DuckDBProcessorR6$disconnect()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
Invisibly returns \code{self}.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DuckDBProcessorR6-register_csv"></a>}}
\if{latex}{\out{\hypertarget{method-DuckDBProcessorR6-register_csv}{}}}
\subsection{Method \code{register_csv()}}{
Register a CSV file as a virtual table for SQL access.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DuckDBProcessorR6$register_csv(file_path, table_name = NULL, options = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{file_path}}{Path to the CSV file.}

\item{\code{table_name}}{Optional table name. If NULL, derived from filename.}

\item{\code{options}}{Named list of DuckDB CSV reader options (e.g., header, delim).}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Invisibly returns \code{self}.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DuckDBProcessorR6-register_parquet"></a>}}
\if{latex}{\out{\hypertarget{method-DuckDBProcessorR6-register_parquet}{}}}
\subsection{Method \code{register_parquet()}}{
Register a Parquet file as a virtual table for SQL access.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DuckDBProcessorR6$register_parquet(file_path, table_name = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{file_path}}{Path to the Parquet file.}

\item{\code{table_name}}{Optional table name. If NULL, derived from filename.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Invisibly returns \code{self}.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DuckDBProcessorR6-register_arrow"></a>}}
\if{latex}{\out{\hypertarget{method-DuckDBProcessorR6-register_arrow}{}}}
\subsection{Method \code{register_arrow()}}{
Register an Arrow/Feather file as a virtual table for SQL access.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DuckDBProcessorR6$register_arrow(file_path, table_name = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{file_path}}{Path to the Feather/Arrow file.}

\item{\code{table_name}}{Optional table name. If NULL, derived from filename.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Invisibly returns \code{self}.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DuckDBProcessorR6-register_all_csvs"></a>}}
\if{latex}{\out{\hypertarget{method-DuckDBProcessorR6-register_all_csvs}{}}}
\subsection{Method \code{register_all_csvs()}}{
Register all CSV files in a directory that match \code{pattern}.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DuckDBProcessorR6$register_all_csvs(data_dir = "data", pattern = "*.csv")}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{data_dir}}{Directory containing CSV files to register.}

\item{\code{pattern}}{Glob pattern for files (default: "*.csv").}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Invisibly returns \code{self}.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DuckDBProcessorR6-register_all_files"></a>}}
\if{latex}{\out{\hypertarget{method-DuckDBProcessorR6-register_all_files}{}}}
\subsection{Method \code{register_all_files()}}{
Register all supported files (parquet/arrow/csv) in a directory.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DuckDBProcessorR6$register_all_files(
  data_dir = "data",
  formats = c("parquet", "arrow", "csv")
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{data_dir}}{Directory containing files to register.}

\item{\code{formats}}{Character vector of formats (subset of c("parquet","arrow","csv")).}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Invisibly returns \code{self}.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DuckDBProcessorR6-export_to_parquet"></a>}}
\if{latex}{\out{\hypertarget{method-DuckDBProcessorR6-export_to_parquet}{}}}
\subsection{Method \code{export_to_parquet()}}{
Export a registered table to a Parquet file.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DuckDBProcessorR6$export_to_parquet(
  table_name,
  output_path,
  compression = "zstd"
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{table_name}}{Name of the registered table to export.}

\item{\code{output_path}}{Destination Parquet file path.}

\item{\code{compression}}{Compression codec to use (e.g., "zstd").}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Invisibly returns \code{self}.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DuckDBProcessorR6-query"></a>}}
\if{latex}{\out{\hypertarget{method-DuckDBProcessorR6-query}{}}}
\subsection{Method \code{query()}}{
Execute a SQL query and return results as a data frame.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DuckDBProcessorR6$query(query, params = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{query}}{SQL query string. May reference registered tables.}

\item{\code{params}}{Optional named list of parameter values for parameterized queries.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A data.frame with query results.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DuckDBProcessorR6-execute"></a>}}
\if{latex}{\out{\hypertarget{method-DuckDBProcessorR6-execute}{}}}
\subsection{Method \code{execute()}}{
Execute a SQL statement that does not return rows (e.g., CREATE INDEX).
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DuckDBProcessorR6$execute(statement, params = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{statement}}{SQL statement string.}

\item{\code{params}}{Optional named list of parameter values.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Invisibly returns TRUE on success.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DuckDBProcessorR6-query_lazy"></a>}}
\if{latex}{\out{\hypertarget{method-DuckDBProcessorR6-query_lazy}{}}}
\subsection{Method \code{query_lazy()}}{
Return a lazy dplyr table reference to an existing DuckDB table.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DuckDBProcessorR6$query_lazy(table_name)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{table_name}}{Name of a registered table.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A dplyr tbl_lazy object.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DuckDBProcessorR6-process_domain"></a>}}
\if{latex}{\out{\hypertarget{method-DuckDBProcessorR6-process_domain}{}}}
\subsection{Method \code{process_domain()}}{
Process and return data for a given domain via SQL, optionally filtered by stream and scales.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DuckDBProcessorR6$process_domain(domain, data_type = "neurocog", scales = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{domain}}{Domain name (character).}

\item{\code{data_type}}{Type of data: "neurocog", "neurobehav", or "validity".}

\item{\code{scales}}{Optional character vector of scales to include; NULL includes defaults for the domain.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A data.frame with processed domain data.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DuckDBProcessorR6-export_to_r6"></a>}}
\if{latex}{\out{\hypertarget{method-DuckDBProcessorR6-export_to_r6}{}}}
\subsection{Method \code{export_to_r6()}}{
Export processed results into a standard R6 processor (e.g., DomainProcessorR6).
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DuckDBProcessorR6$export_to_r6(domain, processor_class = "DomainProcessorR6")}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{domain}}{Domain name to export.}

\item{\code{processor_class}}{R6 class name or generator to use (default: "DomainProcessorR6").}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
An instance of the target R6 processor initialized with the domain data, or a list if class not found.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DuckDBProcessorR6-get_domain_summary"></a>}}
\if{latex}{\out{\hypertarget{method-DuckDBProcessorR6-get_domain_summary}{}}}
\subsection{Method \code{get_domain_summary()}}{
Return summary statistics across domains (neurocog + neurobehav).
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DuckDBProcessorR6$get_domain_summary(include_all = TRUE, by_stream = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{include_all}}{If TRUE, include all known domains (requires a domain reference table; otherwise falls back to domains with data).}

\item{\code{by_stream}}{If TRUE, return one row per (domain, stream). If FALSE, streams are combined.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A data.frame with domain-level summary metrics.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DuckDBProcessorR6-ensure_lookup_registered"></a>}}
\if{latex}{\out{\hypertarget{method-DuckDBProcessorR6-ensure_lookup_registered}{}}}
\subsection{Method \code{ensure_lookup_registered()}}{
Public bootstrap: make lookup visible with join_key.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DuckDBProcessorR6$ensure_lookup_registered(force = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{force}}{If TRUE, re-register even if present.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DuckDBProcessorR6-ensure_domains_ref"></a>}}
\if{latex}{\out{\hypertarget{method-DuckDBProcessorR6-ensure_domains_ref}{}}}
\subsection{Method \code{ensure_domains_ref()}}{
Public bootstrap: rebuild domains_ref from the lookup; carries pass/verbal/timed only for neurocog.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DuckDBProcessorR6$ensure_domains_ref(force = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{force}}{If TRUE, rebuild even if domains_ref already exists.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DuckDBProcessorR6-refresh_enriched_views"></a>}}
\if{latex}{\out{\hypertarget{method-DuckDBProcessorR6-refresh_enriched_views}{}}}
\subsection{Method \code{refresh_enriched_views()}}{
Public bootstrap: create/refresh enriched views; logs unmapped keys per stream to \code{unmapped_tests_log}.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DuckDBProcessorR6$refresh_enriched_views()}\if{html}{\out{</div>}}
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DuckDBProcessorR6-create_indexes"></a>}}
\if{latex}{\out{\hypertarget{method-DuckDBProcessorR6-create_indexes}{}}}
\subsection{Method \code{create_indexes()}}{
Create useful indexes on commonly-queried columns to speed up SQL operations.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DuckDBProcessorR6$create_indexes()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
Invisibly returns TRUE on success.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-DuckDBProcessorR6-clone"></a>}}
\if{latex}{\out{\hypertarget{method-DuckDBProcessorR6-clone}{}}}
\subsection{Method \code{clone()}}{
The objects of this class are cloneable with this method.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{DuckDBProcessorR6$clone(deep = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{deep}}{Whether to make a deep clone.}
}
\if{html}{\out{</div>}}
}
}
}
