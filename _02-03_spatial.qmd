## Visual Perception/Construction {#sec-spatial}

{{< include _02-03_spatial_text.qmd >}}

```{r}
#| label: setup-spatial
#| include: false

# Load required libraries
library(tidyverse)
library(here)
library(gt)
library(gtExtras)
source("DotplotR6.R")
source("TableGT.R")

# Load data
neurocog <- read_csv(here("data/neurocog.csv"))
neurobehav <- read_csv(here("data/neurobehav.csv"))

# Filter by domain
domain_name <- "Visual Perception/Construction"
pheno <- "spatial"

# Filter data for this domain
domain_data <- neurocog %>%
  filter(domain == domain_name | 
         scale %in% c("Spatial Index (SPT)", "NAB Spatial Index", "Visual Discrimination", "Design Construction", "Figure Drawing Copy", "Block Design", "Matrix Reasoning", "Figure Weights"))
```

```{r}
#| label: table-spatial
#| echo: false

# Create table
if (nrow(domain_data) > 0) {
  table_obj <- TableGT2$new(
    data = domain_data,
    pheno = pheno,
    table_name = paste0("table_", pheno),
    title = paste0(domain_name, " Test Scores"),
    source_note = "Standard score: Mean = 100 [50th‰], SD ± 15 [16th‰, 84th‰]"
  )
  
  table_obj$build_table()
}
```

```{r}
#| label: figure-spatial
#| echo: false
#| fig-cap: "Visual Perception/Construction subdomain scores"

# Create dotplot figure
if (nrow(domain_data) > 0 && "z_mean_subdomain" %in% colnames(domain_data)) {
  subdomain_data <- domain_data %>%
    group_by(subdomain) %>%
    summarise(z_mean = mean(z_mean_subdomain, na.rm = TRUE)) %>%
    filter(!is.na(z_mean))
  
  if (nrow(subdomain_data) > 0) {
    dotplot_obj <- DotplotR6$new(
      data = subdomain_data,
      x = "z_mean",
      y = "subdomain",
      filename = paste0("fig_", pheno, "_subdomain.svg")
    )
    
    dotplot_obj$create_plot()
  }
}
```