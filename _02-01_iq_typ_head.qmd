```{=typst}
== General Cognitive Ability
```

<!-- ## General Cognitive Ability {#sec-iq} -->

{{< include _02-01_iq_text.qmd >}}

```{r}
#| label: setup-iq
#| echo: false
#| include: false
#| warning: false
#| message: false

# Source R6 classes
source("R/DomainProcessorR6.R")
source("R/NeuropsychResultsR6.R")
source("R/DotplotR6.R")
source("R/TableGTR6.R")
source("R/score_type_utils.R")

# Initialize score type cache if it exists
if (file.exists("R/ScoreTypeCacheR6.R")) {
  source("R/ScoreTypeCacheR6.R")
  if (exists(".ScoreTypeCacheR6")) {
    .ScoreTypeCacheR6$build_mappings()
  }
}

# Filter by domain
domains <- c("General Cognitive Ability")

# Target phenotype
pheno <- "iq"

# Create R6 processor
processor_iq <- DomainProcessorR6$new(
  domains = domains,
  pheno = pheno,
  input_file = "data/neurocog.csv"
)

# Load and process data
processor_iq$load_data()
processor_iq$filter_by_domain()

# Create the data object
iq <- processor_iq$data

# Process and export data
processor_iq$select_columns()
processor_iq$save_data()

# Update the original object
iq <- processor_iq$data
```

```{r}
#| label: table-iq
#| echo: false
#| warning: false
#| message: false

# Generate table using TableGTR6
if (nrow(iq) > 0) {
  table_iq <- TableGTR6$new(
    data = iq,
    pheno = "iq",
    source_note = "Standard score: Mean = 100 [50th‰], SD ± 15 [16th‰, 84th‰]"
  )
  table_iq$generate_table()
  table_iq$save_table_png(filename = "table_iq.png")
}
```

```{r}
#| label: plot-iq
#| echo: false
#| fig-cap: 'Intellectual and cognitive abilities'
#| fig-height: 4.5
#| fig-width: 10
#| out-width: "100%"

# Generate dotplot using DotplotR6
if (nrow(iq) > 0) {
  plot_iq <- DotplotR6$new(
    data = iq,
    x_var = "percentile",
    y_var = "scale",
    colors = c("#d7191c", "#fdae61", "#abdda4", "#2b83ba"),
    return_plot = TRUE
  )
  plot_iq$generate_plot()
  print(plot_iq$plot)
}
```

